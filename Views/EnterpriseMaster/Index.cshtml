@{
    var EnterpriseMasterData = ViewData["EnterpriseMasterData"] ?? "[]";
    Layout = "_Layout";
}


<style>
    .main-container {
        margin-left: 5px;
        margin-right: 5px;
    }
</style>
<div class="main-container">
    <!--  Page title header -->
@*     <div id="pageTitle" class="col-12 text-center py-1 mb-3 page-title">
        <!--  Toolbar row with search + action buttons -->
        <h6 class="mb-0 fw-bold text-uppercase tracking-wide">Enterprise Master</h6>
    </div> *@
    <div class="col-12 text-center py-1 mb-3" style="background: #242424; color: white;">
        <h6 class="mb-0 fw-bold text-uppercase tracking-wide">Enterprise Master</h6>
    </div>

    <!--  Toolbar row with search + action buttons -->
    <div class="row align-items-center mb-3">

        <!-- Spacer on xs devices -->
        <div class="w-100 d-md-none"></div>
        <div class="col-12 col-md d-flex justify-content-md-end align-items-center gap-2 flex-wrap">
            <!--  Global search input -->
            <input type="search"
                   id="searchField"
                   class="form-control form-control-sm"
                   placeholder="Search..."
                   style="max-width: 280px; min-width: 150px;" />

        </div>


    </div>
    <!--  Hidden file input for CSV upload -->
    <input type="file" id="upload-file" style="display:none" accept=".csv" />

    <!--  Tabulator grid mount point -->
    <div id="EnterpriseMasterTable" class="tabulator-bootstrap5"></div>
    @* <div id="recordCount" class="text-end mt-2 fw-semibold text-secondary"></div> *@
     <div id="recordCount" class="footer-total-records"></div>
</div>

<script>


    document.addEventListener("DOMContentLoaded", () => {
        // ==========================
        // 🔹 Initialize reusable components
        // ==========================
        initTooltips(); // Bootstrap tooltips


        const EnterpriseMasterData = JSON.parse('@Html.Raw(EnterpriseMasterData)');
        let selectedRow = null;
        let currentMode = "";

      

        // ==========================
        // 🔹 Initialize Tabulator
        // ==========================
       
        // const dataTable = initializeTabulator("#EnterpriseMasterTable", EnterpriseMasterData, generateTabulatorColumns(EnterpriseMasterData),
        //      (data) => selectedRow = data[0] || null
        // );
        	const dataTable = new Tabulator("#EnterpriseMasterTable", {
	            data: EnterpriseMasterData,
	           
                 columns: [
                    { title: "Enterprise Code", field: "Enterprise_code", width: 220 },
                    { title: "Enterprise Name", field: "Enterprise_name", width: 250 },
                    { title: "Description", field: "Description", width: 220 }
                ],
	            layout: "fitDataStretch",
	            height: "80vh",
	            selectable: 1,
	            pagination: "local",
	            resizableRows:false,
	            resizableRowGuide:false,
	            resizableColumnGuide:false,
	            columnDefaults:{
		            resizable:false,
	            },           
	            movableColumns: false,
	            paginationSize: 10,
	            paginationSizeSelector: [5, 10, 20, 50, 100],
	             locale: true,
	            langs: {
		            "en": {
	            pagination: {
		            first: "<<",
		            first_title: "First",
		            last: ">>", 
		            last_title: "Last", 
		            prev: "<", 
		            prev_title: "Prev",
		            next: ">", 
		            next_title: "Next", 
		            page_size: "Page Size" 
		             }
		            }
	             },

	            rowClick: function (e, row) {
	              selectedRow = row.getData();
	            }
	            });
        dataTable.on("tableBuilt", function(){
            const hideFields = [
                    "Enterprise_id",
                    "Status_id",
                    "Status_name",
                    "Is_deleted",
                    "Created_by",
                    "Created_at",
                    "Updated_by",
                    "Updated_at",
                    "Version",
                    "AdditionalProperties"
            ];

            hideFields.forEach(field => dataTable.hideColumn(field));
        });
    
           
        // Command: Live search (visible columns only) for parent table
        document.getElementById("searchField").addEventListener("input", function () {
            var searchTerm = this.value.toLowerCase();

            // Command: Collect visible fields
            var visibleColumns = dataTable.getColumns()
                                      .filter(col => col.isVisible())
                                      .map(col => col.getField());

            // Command: Apply per-row predicate filter
            dataTable.setFilter(function (data) {
                return visibleColumns.some(field => {
                    var value = data[field];
                    return value != null && value.toString().toLowerCase().includes(searchTerm);
                });
            });
        });
        // Record count for filtered data
         dataTable.on("dataFiltered", function(filters, rows) {
               updateRecordCount(dataTable, rows, "Enterprise_id");  // Pass the field name >>replace with your table primary id column
         });

         // Record count for loaded data
         dataTable.on("dataLoaded", function(data) {
               updateRecordCount(dataTable, data, "Enterprise_id");  // Pass the field name >>replace with your table primary id column
         });

    });
</script>
