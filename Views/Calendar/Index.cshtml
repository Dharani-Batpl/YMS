@{
    ViewData["Title"] = "Shift Calendar";
}

<style>
    .main-container {
        margin-left: 5px !important;
        margin-right: 5px !important;
    }

    /* Calendar Box Height Reduced */
    #calendar {
        max-height: 600px;  /* reduced height */
    }

    .filter-label {
        font-weight: 600;
        font-size: 0.85rem;
        margin-bottom: 3px;
    }

    .form-select, .form-control {
        border-radius: 4px !important;
        height: 36px !important;
    }

    .toolbar-btn {
        padding-left: 25px !important;
        padding-right: 25px !important;
        font-weight: 600 !important;
    }
    .form-label {
    font-size: 0.8rem;
        font-weight: 600;
    }

    .form-select-sm, .form-control-sm {
        padding: 3px 6px;
        height: 32px;
    }

    .btn-sm {
        height: 32px;
        font-size: 0.8rem;
    }

</style>

<div class="main-container">

    <!------- Page Title Section ------->

    <div class="col-12 text-center py-1 mb-3" style="background:#242424;color:white;">
        <h6 class="mb-0 fw-bold text-uppercase tracking-wide">SHIFT CALENDAR</h6>
    </div>


   <div class="row g-2 align-items-end mb-3">

        <!-- Site -->
        <div class="col-xl-2 col-lg-3 col-md-3">
            <label class="form-label">Select Site</label>
            <select class="form-select form-select-sm">
                <option>Site 1</option>
                <option>Site 2</option>
            </select>
        </div>

        <!-- Start Date -->
        <div class="col-xl-2 col-lg-3 col-md-3">
            <label class="form-label">Start Date</label>
            <input type="date" class="form-control form-control-sm" />
        </div>

        <!-- End Date -->
        <div class="col-xl-2 col-lg-3 col-md-3">
            <label class="form-label">End Date</label>
            <input type="date" class="form-control form-control-sm" />
        </div>

        <!-- Template -->
        <div class="col-xl-2 col-lg-3 col-md-3">
            <label class="form-label">Select Template</label>
            <select class="form-select form-select-sm">
                <option>Standard Template</option>
                <option>Night Template</option>
            </select>
        </div>

        <!-- Buttons Group -->
        <div class="col-xl-4 col-lg-12 d-flex gap-2 justify-content-end flex-wrap mt-2">
            <button class="btn btn-primary btn-sm px-4">Apply</button>
            <button class="btn btn-danger btn-sm px-4">Assign Shifts</button>
            <button class="btn btn-success btn-sm px-4">+ Add Holiday</button>
        </div>
    </div>


    <!------- CALENDAR BOX ------->

    <div class="card p-3" style="border-radius:10px;">
        <div id="calendar"></div>
    </div>

</div>


<!-- Event Modal -->
<div class="modal fade" id="eventModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Add Event</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">
                <form id="eventForm">
                    <div class="mb-3">
                        <label class="form-label">Event Title</label>
                        <input type="text" id="eventTitle" class="form-control" required />
                    </div>
                    <input type="hidden" id="eventDate" />
                    <button type="submit" class="btn btn-primary">Save</button>
                </form>
            </div>

        </div>
    </div>
</div>

<!-- Context Menu -->
<ul id="contextMenu" class="dropdown-menu" style="position:absolute; display:none;">
    <li><a class="dropdown-item" href="#" id="addEvent">Add Event</a></li>
</ul>

<script src="~/lib/fullcalendar/index.global.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function () {

        const calendarEl = document.getElementById('calendar');
        const contextMenu = $('#contextMenu');
        let selectedDate = null;

        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            selectable: true,
            editable: true,
            events: '/Calendar/GetEvents',

            select: function (arg) {
                var title = prompt('Event Title:');
                if (title) {
                    calendar.addEvent({
                        title: title,
                        start: arg.start,
                        end: arg.end,
                        allDay: arg.allDay
                    });
                }
                calendar.unselect();
            },

            eventClick: function (arg) {
                if (confirm('Delete this event?')) {
                    arg.event.remove();
                }
            },

            dateClick: function (info) {
                selectedDate = info.dateStr;
            }
        });

        calendar.render();

        // ===== Right-click Open Context Menu =====
        $(calendarEl).on('contextmenu', '.fc-daygrid-day', function (e) {
            e.preventDefault();
            selectedDate = $(this).data('date');

            contextMenu.css({
                display: 'block',
                left: e.pageX,
                top: e.pageY
            });
        });

        $(document).on('click', function () {
            contextMenu.hide();
        });

        // ===== Add Event From Context Menu =====
        $('#addEvent').on('click', function () {
            $('#eventDate').val(selectedDate);
            $('#eventModal').modal('show');
        });

        // ===== Save Event =====
        $('#eventForm').on('submit', function (e) {
            e.preventDefault();

            const title = $('#eventTitle').val();
            const date = $('#eventDate').val();

            if (title && date) {
                $.ajax({
                    url: '/Calendar/AddEvent',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ Title: title, Start: date }),
                    success: function () {
                        calendar.addEvent({ title: title, start: date });
                        $('#eventModal').modal('hide');
                        $('#eventForm')[0].reset();
                    }
                });
            }
        });
    });
</script>
